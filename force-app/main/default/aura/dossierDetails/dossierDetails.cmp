<aura:component controller="CompanyDetailsController" implements="flexipage:availableForRecordHome,force:hasRecordId,force:lightningQuickAction" access="global">
    <aura:attribute name="step" type="string" default="1" />
    <aura:attribute name="companyList" type="object" default="{}" />
    <aura:attribute name="selected" type="object" default="{}" />
    <aura:attribute name="dossierId" type="String" />
    <aura:attribute name="simpleRecord" type="object" />
    <aura:attribute name="myTitleName" type="Aura.Component[]">
        <div class="logoContainer"><img src="{!$Resource.AppsolutelyLogo}"/></div>
    </aura:attribute>
    <aura:attribute name="error" type="string" description="error message. Shown when changed and not null in toast"/>

    <aura:handler name="dossierSearchSubmitEvent" event="c:dossierSearchSubmitEvent" action="{!c.onSubmit}" />
    <aura:handler name="dossierSelectionConfirmedEvent" event="c:dossierSelectionConfirmedEvent" action="{!c.onSelect}" />
    <aura:handler name="errorChange" value="{!v.error}" action="{!c.onErrorChange}"/>

    <aura:if isTrue="{!v.recordId}">
        <force:recordData aura:id="recordHandler" recordId="{!v.recordId}" targetFields="{!v.simpleRecord}" layoutType="FULL"
            fields="cust_connect__Business_Dossier__c" mode="EDIT" />
    </aura:if>

    <div class="{!(!v.simpleRecord ? (v.recordId ? 'spinnerHolder' : 'slds-hide') : 'slds-hide')}">
        <lightning:spinner alternativeText="..." size="small"/>
    </div>

    <div class="{!(!v.simpleRecord ? (v.recordId ? 'slds-hide' : '') : '')}">
                    
        <div class="{!v.simpleRecord.cust_connect__Business_Dossier__c != null ? 'slds-hide' : ''}">
            <div class="{!v.step == '1' ? '' : 'slds-hide'}">
                <c:dossierSearchForm recordId="{!v.recordId}" error="{!v.error}" />
            </div>
            <div class="{!v.step == '2' ? '' : 'slds-hide'}" title="{!$Label.c.Matching_Companies}" iconName="standard:account">
                <lightning:button iconPosition="left" variant="neutral" type="submit" label="{!$Label.c.Search_Reset}"
                                  iconName="utility:chevronleft" onclick="{!c.onBack}" />
                <c:dossierSearchResults recordId="{!v.recordId}" wrapperList="{!v.companyList}" />
            </div>
        </div>

        <div class="{!v.simpleRecord.cust_connect__Business_Dossier__c != null ? '' : 'slds-hide'}">
            <div class="slds-box slds-theme_default slds-m-bottom_small">
                <lightning:card variant="Narrow" >
                    <aura:set attribute="title">{!v.myTitleName}</aura:set>
                    <aura:set attribute="actions">
                        <lightning:button label="{!$Label.c.VAT_Retrieve}" onclick="{!c.getVAT}" />
                        <lightning:button label="{!$Label.c.Dossier_Remove}" onclick="{!c.removeDossier}" />
                    </aura:set>
                </lightning:card>
            </div>
            <c:PageLayoutRecordDisplay RecordId="{!v.simpleRecord.cust_connect__Business_Dossier__c}" PageLayoutName="Business_Dossier__c-Dutch Business Dossier Layout" objectApiName="cust_connect__Business_Dossier__c" />
        </div>
    </div>
</aura:component>
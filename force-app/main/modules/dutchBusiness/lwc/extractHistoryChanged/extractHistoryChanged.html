<!--
 - Created by Hugo on 12/06/2020.
 -->

<!-- Extract History Changed -->
<template>


    <article class="slds-card">
        <div class="slds-is-relative">
            <template if:true={isLoading}>
                <lightning-spinner size="medium"></lightning-spinner>
            </template>
            <div class="slds-card__header slds-grid">
                <header class="slds-media slds-media_center slds-has-flexi-truncate">
                    <div class="slds-media__figure">
                        <lightning-icon icon-name="standard:record" title="records"></lightning-icon>
                    </div>
                    <div class="slds-media__body">
                        <h2 class="slds-card__header-title">
                            <a href="javascript:void(0);" class="slds-card__header-link slds-truncate" title="Accounts">
                                <span>Extract History</span>
                            </a>
                        </h2>
                    </div>
                </header>
            </div>
            <div class="slds-card__body slds-card__body_inner">
                <template if:false={hasBusinessDossierNumber}>
                    <div>Please link this account to a business dossier first.</div>
                </template>
                <template if:true={hasBusinessDossierNumber}>
                    <div class="slds-grid slds-wrap">
                        <div class="slds-size_2-of-3 slds-grid slds-wrap">
                            <div class="slds-size_1-of-1">Last update:</div>
                            <div class="slds-size_1-of-1">Would you like to see if a new extract is available?</div>
                        </div>
                        <div class="slds-size_1-of-3 slds-float_right">
                            <lightning-button label="Get Extract History"
                                              onclick={retrieveExtractHistory}></lightning-button>
                        </div>
                    </div>
                    <template if:true={hasExtractHistory}>
                        <table class="slds-table slds-table_cell-buffer slds-table_bordered">
                            <thead>
                            <tr>
                                <th>Extract Id</th>
                                <th>Document Date</th>
                                <th>Changes</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            <template iterator:it={extractHistory.references.item} >
                                <tr key={it.value.extract_id}>
                                    <td>{it.value.extract_id}</td>
                                    <td><lightning-formatted-date-time value={it.value.document_date} ></lightning-formatted-date-time> </td>
                                    <td>{it.value.change_set.changes.item}</td>
                                    <template if:true={it.first}>
                                        <td>
                                            <div onclick={retrieveExtract} name={it.value.extract_id}>
                                                <lightning-icon icon-name="action:download" size="xx-small"></lightning-icon>
                                            </div>
                                        </td>
                                    </template>

                                </tr>
                            </template>
                            </tbody>

                        </table>
                    </template>
                </template>
            </div>
        </div>
    </article>

    <c-modal header="Confirmation" onclosedialog={handleConfirmationModalClosed}>
        <div slot="footer" class="slds-grid slds-float_right">
            <div class="slds-float_right slds-m-right_xx-small">
                <lightning-button onclick={handleConfirmationModalClosed} label="Cancel"></lightning-button>
            </div>
            <div class="slds-float_right">
                <lightning-button type="submit" variant="brand"
                                  onclick={handleConfirmationModalAccepted} label="Download"></lightning-button>
            </div>
        </div>

    </c-modal>


</template>